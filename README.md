# disk_shrink

### 使用
./disk_shrink.py --shrink [--worker=8] dir
- 不带 shrink 参数只扫描目录重复文件，不执行其它操作
- worker 参数指定工作线程数（默认8）

### 行为
- 扫描目录寻找重复文件
- 将文件重命名（*.uuid.bak格式）
- 拷贝文件
- 校验拷贝后文件与重命名文件内容
- 删除重命名文件
- 设置拷贝文件修改时间

### 原理
- 文件系统支持 COW，故相同文件删除重新拷贝后，就会只占用一份空间

### 其它
- 与硬链接的差异：实际是不同的 inode，修改其中一个文件，其它文件不会跟着变

### 系统要求
- macOS系统
  - APFS文件系统

 ### 问题
- 文件创建时间未回复
- 无法识别已经收缩过的文件，第二次执行无意义

### TODO
- 文件创建时间恢复
- 其它文件系统支持
- 识别已经是合并过存储空间的文件
